#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# 检测非 ASCII 字符（中文等）
echo "检查提交文件中的非 ASCII 字符..."
if git diff --cached --name-only --diff-filter=ACM | while read file; do
  if [ -f "$file" ]; then
    if grep -q '[^\x00-\x7F]' "$file"; then
      echo "❌ 错误: 文件 '$file' 包含非 ASCII 字符（如中文）。禁止提交。"
      exit 1
    fi
  fi
done; then
  :
else
  exit 1
fi

# 运行 prettier 格式化
echo "运行 prettier 格式化..."
npx prettier --write --ignore-unknown $(git diff --cached --name-only --diff-filter=ACM)

# 重新添加格式化后的文件
git add $(git diff --cached --name-only --diff-filter=ACM)

echo "✓ Pre-commit 检查完成"
